<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Desafio do Saber Matem√°tica!</title>
    <style>
          body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            
            /* ** MUDAN√áA FUTURISTA: Fundo Escuro e Imagem ** */
            background-color: rgb(252, 252, 252), 225, 226; /* Azul escuro/preto de fundo */
            background-image: url('https://wallpapers.com/images/hd/futuristic-background-ekkbk8ew3gnp4olb.jpg'); 
            background-size: cover;
            background-position: center;
            color: #e0e0e0; /* Cor de texto mais clara para contraste */
        }

        .sidenav {
            height: 100%;
            width: 220px;
            position: fixed;
            top: 0;
            left: 0;
            /* Cores Futuras: Azul Marinho com Borda Neon */
            background-color: rgb(240, 241, 241, 250, 250, 226, 228);
            padding-top: 20px;
            color: #00ffcc; /* Verde Neon */
            box-shadow: 4px 0 15px rgba(0, 255, 204, 0.4); /* Sombra Neon */
            z-index: 10;
        }

        .sidenav h3 {
            border-bottom: 2px solid #00ffcc;
            padding-bottom: 10px;
            margin: 0 20px 20px 20px;
        }

        .sidenav a {
            padding: 10px 20px;
            text-decoration: none;
            font-size: 18px;
            color: #e0e0e0;
            display: block;
            transition: background-color 0.3s, color 0.3s;
        }

        .sidenav a:hover {
            background-color: #00ffcc;
            color: rgb(184, 189, 196);
        }

        .main {
            margin-left: 240px;
            padding: 20px;
        }
        /* --- ESTILOS DE COMPONENTES --- */

        #tituloFase {
            color: #ff6600; /* T√≠tulo em neon laranja */
        }

        .hints {
            font-weight: bold;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #00ffcc; /* Borda Neon */
            background-color: #2d3f52; /* Fundo escuro */
            border-radius: 5px;
            color: #e0e0e0;
        }

        .game-area {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .crossword {
            display: grid;
            grid-template-columns: repeat(10, 35px);
            grid-auto-rows: 35px;
            grid-gap: 2px;
            border: 2px solid #00ffcc; /* Borda Neon */
            padding: 5px;
            background-color: #1e3146; /* Fundo do tabuleiro */
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
        }

        .cell {
            width: 35px;
            height: 35px;
            border: 1px solid #00ffcc;
            text-align: center;
            line-height: 35px;
            font-size: 16px;
            background-color: #334e68; /* C√©lula com cor escura */
            color: #f9f9f9;
            user-select: none;
            cursor: pointer;
            font-weight: bold;
        }
        
        .empty-cell {
            background-color: transparent;
            border: none;
            cursor: default;
        }

        /* Estilos do Painel de D√≠gitos */
        .panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            max-width: 300px;
            padding: 15px;
            border: 1px solid #2a474b;
            background-color: #1e3a47;
            border-radius: 8px;
        }

        /* Estilos do D√≠gito (letra) */
        .digit {
            width: 40px;
            height: 40px;
            background-color: #ff5722; /* Laranja vibrante */
            color: white;
            text-align: center;
            line-height: 40px;
            font-size: 20px;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 0 5px #ff5722;
            transition: transform 0.1s, box-shadow 0.3s;
        }

        .digit:active {
            transform: scale(0.95);
            box-shadow: 0 0 10px #ff5722;
        }

        .cell.over {
            background-color: #f5f5f5; /* Cor de destaque ao arrastar */
        }

        /* Estilos dos Bot√µes */
        button {
            margin: 5px 10px 5px 0;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s, opacity 0.3s;
            font-weight: bold;
        }

        #verificarBtn { background-color: #ff1744; color: white; } /* Vermelho neon */
        #limparBtn { background-color: #ffeb3b; color: #0d1a26; } /* Amarelo neon */
        #proximaRodadaBtn { background-color: #00e676; color: #0d1a26; } /* Verde neon */

        button:hover { opacity: 0.8; }

        /* Estilos dos Resultados */
        .result {
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.2em;
        }

        #result.success { color: #00e676; }
        #result.error { color: #ff1744; }
    </style>
</head>
<body>
    
    <div class="sidenav" id="sidenav">
        <h3>Desafio do Saber Matem√°tica!. üß†</h3>
        <a href="index.html">In√≠cio</a>
        <a href="Regras e Pontua√ß√£o.html">Regras e Pontua√ß√£o</a>
        <a href="Tabela de Fases Mat.html">Tabela de Fases</a>
        <a href="Sobre jogo Mat.html">Sobre o Jogo</a>
    </div>

    <div class="main">
        <h1 id="tituloFase">Desafio do Saber Matem√°tica! - Fase 1</h1>
        <h2><p>Arraste os "d√≠gitos/caracteres" para preencher o tabuleiro e resolva as opera√ß√µes!</p></h2>

        <div class="hints" id="hints">
        </div>

        <div class="game-area">
            <div class="crossword" id="crossword">
            </div>

            <div class="panel" id="panel">
            </div>
        </div>

        <button id="verificarBtn" onclick="verificar()">Verificar Respostas</button>
        <button id="limparBtn" onclick="limpar()">Limpar Quadros</button>
        <button id="proximaRodadaBtn" onclick="proximaRodada()">Pr√≥xima Fase</button>

        <div class="result" id="result"></div>
        <div class="result" id="estatisticas"></div>

    </div>

    <script>
        let currentPhase = 0;
        let acertos = 0;
        let draggedDigit = null;

        // --- DADOS PARA AS 20 FASES DE MATEM√ÅTICA ---
        // Estrutura: { operacoes: [{op: '1. Op.', resultado: 'Resposta'}, ...], layout: [[]], gridSize: [linhas, colunas], digitosDisponiveis: '...' }
        // Nota: O resultado deve ser uma STRING. Use '.' para decimal e '-' para negativo.
        const phases = [
            // Fase 1: Soma e Subtra√ß√£o Simples
            {
                operacoes: [
                    { op: '1) 10 + 5', resultado: '15' },
                    { op: '2) 20 - 7', resultado: '13' },
                    { op: '3) 8 + 4', resultado: '12' }
                ],
                // 0: vazio, 1-N: √≠ndice da opera√ß√£o
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, , , 0, 0, 0],
                    [0, 0, 2, 2, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, , , 0, 0, 0, 0],
                    [3, 3, 0, 0, 0, 0, 0, 0, 0, 0]
                ],
                gridSize: [5, 10], 
                digitosDisponiveis: '123578'
            },
            
            // Fase 2: Soma e Multiplica√ß√£o
            {
                operacoes: [
                    { op: '1) 7 * 3', resultado: '21' },
                    { op: '2) 12 + 19', resultado: '31' },
                    { op: '3) 4 * 6', resultado: '24' },
                    { op: '4) 100 + 10', resultado: '110' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [2, 2, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 0, 3, 3, 0, 0, 0, 0, 0],
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [4, 4, 4, 0, 0, 0, 0, 0, 0, 0]
                ],
                gridSize: [6, 10],
                digitosDisponiveis: '012347'
            },
            
            // Fase 3: Multiplica√ß√£o e Divis√£o (Inteiros)
            {
                operacoes: [
                    { op: '1) 9 * 9', resultado: '81' },
                    { op: '2) 50 / 5', resultado: '10' },
                    { op: '3) 11 * 11', resultado: '121' },
                    { op: '4) 49 / 7', resultado: '7' },
                    { op: '5) 6 * 8', resultado: '48' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // 81
                    [0, 0, 0, 0, 2, 2, 0, 0, 0, 0], // 10
                    [3, 3, 3, 0, 0, 0, 0, 0, 0, 0], // 121
                    [0, 0, 0, 4, 0, 0, 0, 0, 0, 0], // 7
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [5, 5, 0, 0, 0, 0, 0, 0, 0, 0] // 48
                ],
                gridSize: [6, 10],
                digitosDisponiveis: '0124789'
            },
            
            // Fase 4: Divis√£o com Decimal (ponto)
            {
                operacoes: [
                    { op: '1) 1 / 2', resultado: '0.5' },
                    { op: '2) 10 * 10', resultado: '100' },
                    { op: '3) 15 / 3', resultado: '5' },
                    { op: '4) 20 * 5', resultado: '100' },
                    { op: '5) 5 - 1.5', resultado: '3.5' },
                    { op: '6) 10 / 4', resultado: '2.5' }
                ],
                layout: [
                    [1, 1, 1, 0, 0, 0, 0, 0, 0, 0], /* 0.5 */
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [2, 2, 2, 0, 0, 0, 0, 0, 0, 0], /* 100 */
                    [0, 0, 0, 3, 0, 0, 0, 0, 0, 0], /* 5 */
                    [4, 4, 4, 0, 0, 0, 0, 0, 0, 0], /* 100 */
                    [0, 0, 0, 0, 5, 5, 5, 0, 0, 0], /* 3.5 */
                    [6, 6, 6, 0, 0, 0, 0, 0, 0, 0] /* 2.5 */
                ],
                gridSize: [7, 10],
                digitosDisponiveis: '012345.'
            },

            // Fase 5: Potencia√ß√£o e Raiz Quadrada
            {
                operacoes: [
                    { op: '1) 4 ^ 2 (4 ao quadrado)', resultado: '16' },
                    { op: '2) 2 ^ 3 (2 ao cubo)', resultado: '8' },
                    { op: '3) Raiz Quadrada de 25', resultado: '5' },
                    { op: '4) 10 ^ 1 (10 elevado a 1)', resultado: '10' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], /* 16 */
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 2, 0, 0, 0, 0, 0, 0, 0], /* 8 */
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 0, 0, 0, 0, 0, 0, 0, 0, 0], /* 5 */
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [4, 4, 0, 0, 0, 0, 0, 0, 0, 0]  /* 10 */
                ],
                gridSize: [7, 10],
                digitosDisponiveis: '012568'
            },
            
            // --- NOVAS FASES (6 a 20) ---
            
            // Fase 6: Ordem de Opera√ß√µes (PEMDAS/BODMAS)
            {
                operacoes: [
                    { op: '1) 2 + 3 * 4', resultado: '14' },
                    { op: '2) (10 - 2) / 4', resultado: '2' },
                    { op: '3) 5 * (6 + 1)', resultado: '35' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // 14
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 2, 0, 0, 0, 0, 0, 0, 0], // 2
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 0, 0, 0, 0, 0, 0, 0, 0]  // 35
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '12345'
            },

            // Fase 7: N√∫meros Negativos (Introdu√ß√£o)
            {
                operacoes: [
                    { op: '1) 5 - 10', resultado: '-5' },
                    { op: '2) -3 + 7', resultado: '4' },
                    { op: '3) 2 * -4', resultado: '-8' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // -5
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [2, 0, 0, 0, 0, 0, 0, 0, 0, 0], // 4
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 3, 3, 0, 0, 0, 0, 0, 0, 0]  // -8
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '458-'
            },
            
            // Fase 8: M√©dia e Porcentagem Simples
            {
                operacoes: [
                    { op: '1) M√©dia de 10, 20, 30', resultado: '20' },
                    { op: '2) 50% de 80', resultado: '40' },
                    { op: '3) 10% de 100', resultado: '10' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // 20
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [2, 2, 0, 0, 0, 0, 0, 0, 0, 0], // 40
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 0, 0, 0, 0, 0, 0, 0, 0]  // 10
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '0124'
            },

            // Fase 9: Fra√ß√µes (resultado decimal simples)
            {
                operacoes: [
                    { op: '1) 3 / 4', resultado: '0.75' },
                    { op: '2) 1 / 5', resultado: '0.2' },
                    { op: '3) 1 / 8', resultado: '0.125' }
                ],
                layout: [
                    [1, 1, 1, 1, 0, 0, 0, 0, 0, 0], // 0.75
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [2, 2, 2, 0, 0, 0, 0, 0, 0, 0], // 0.2
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 3, 3, 3, 0, 0, 0, 0, 0] // 0.125
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '012357.'
            },

            // Fase 10: Equa√ß√µes Lineares Simples (Resolva para X)
            {
                operacoes: [
                    { op: '1) X + 5 = 12', resultado: '7' },
                    { op: '2) 3 * X = 18', resultado: '6' },
                    { op: '3) X - 1 = -3', resultado: '-2' }
                ],
                layout: [
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], // 7
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 2, 0, 0, 0, 0, 0, 0, 0, 0], // 6
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 3, 3, 0, 0, 0, 0, 0, 0] // -2
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '2367-'
            },

            // Fase 11: M√∫ltiplos D√≠gitos e Ponto Flutuante
            {
                operacoes: [
                    { op: '1) 150 * 0.1', resultado: '15' },
                    { op: '2) 12.5 + 7.5', resultado: '20' },
                    { op: '3) 1000 / 4', resultado: '250' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // 15
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [2, 2, 0, 0, 0, 0, 0, 0, 0, 0], // 20
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 3, 0, 0, 0, 0, 0, 0, 0] // 250
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '0125'
            },

            // Fase 12: Pot√™ncias e Ra√≠zes Negativas/Decimais
            {
                operacoes: [
                    { op: '1) Raiz C√∫bica de 27', resultado: '3' },
                    { op: '2) (-2) * 2', resultado: '-4' },
                    { op: '3) 1 ^ 100', resultado: '1' }
                ],
                layout: [
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], // 3
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 2, 2, 0, 0, 0, 0, 0, 0, 0], // -4
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 0, 0, 0, 0, 0, 0, 0, 0, 0] // 1
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '134-'
            },

            // Fase 13: Porcentagem Inversa
            {
                operacoes: [
                    { op: '1) O n√∫mero cuja 10% √© 5', resultado: '50' },
                    { op: '2) 25% de X = 4', resultado: '16' },
                    { op: '3) 2 * 30', resultado: '60' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // 50
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 2, 2, 0, 0, 0, 0, 0, 0, 0], // 16
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 0, 0, 0, 0, 0, 0, 0, 0]  // 60
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '0156'
            },

            // Fase 14: Express√µes Alg√©bricas (simples, com vari√°vel)
            {
                operacoes: [
                    { op: '1) 2X + 1 (onde X=4)', resultado: '9' },
                    { op: '2) 3(X-2) (onde X=5)', resultado: '9' },
                    { op: '3) X * X (onde X=12)', resultado: '144' }
                ],
                layout: [
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], // 9
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 2, 0, 0, 0, 0, 0, 0, 0, 0], // 9
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 3, 0, 0, 0, 0, 0, 0, 0] // 144
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '149'
            },
            
            // Fase 15: Arredondamento e Aproxima√ß√£o
            {
                operacoes: [
                    { op: '1) 10 / 3 (2 casas decimais)', resultado: '3.33' },
                    { op: '2) Raiz Quadrada de 100', resultado: '10' },
                    { op: '3) 1 / 6 (2 casas decimais)', resultado: '0.17' }
                ],
                layout: [
                    [1, 1, 1, 1, 0, 0, 0, 0, 0, 0], // 3.33
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [2, 2, 0, 0, 0, 0, 0, 0, 0, 0], // 10
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 3, 3, 0, 0, 0, 0, 0, 0] // 0.17
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '0137.'
            },

            // Fase 16: Coordenadas e Geometria Simples (per√≠metro)
            {
                operacoes: [
                    { op: '1) Per√≠metro de quadrado lado 7', resultado: '28' },
                    { op: '2) √Årea de quadrado lado 3', resultado: '9' },
                    { op: '3) 4 * 4', resultado: '16' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // 28
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 2, 0, 0, 0, 0, 0, 0, 0, 0], // 9
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 0, 0, 0, 0, 0, 0, 0, 0]  // 16
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '12689'
            },

            // Fase 17: Equa√ß√µes de M√∫ltiplos Passos
            {
                operacoes: [
                    { op: '1) (10 + 2) / (5 - 2)', resultado: '4' },
                    { op: '2) 100 / (2 * 5)', resultado: '10' },
                    { op: '3) 3 * 3 + 1', resultado: '10' }
                ],
                layout: [
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], // 4
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 2, 2, 0, 0, 0, 0, 0, 0, 0], // 10
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 0, 0, 0, 0, 0, 0, 0, 0]  // 10
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '014'
            },

            // Fase 18: N√∫meros Primos e Fatora√ß√£o (simples)
            {
                operacoes: [
                    { op: '1) O maior fator primo de 14', resultado: '7' },
                    { op: '2) O menor n√∫mero primo', resultado: '2' },
                    { op: '3) 10 / 2', resultado: '5' }
                ],
                layout: [
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0], // 7
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 2, 0, 0, 0, 0, 0, 0, 0, 0], // 2
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 0, 3, 0, 0, 0, 0, 0, 0, 0]  // 5
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '257'
            },

            // Fase 19: Volume e Unidades (Convers√£o Impl√≠cita)
            {
                operacoes: [
                    { op: '1) Volume de um cubo lado 4', resultado: '64' },
                    { op: '2) 1 kg em gramas / 10', resultado: '100' },
                    { op: '3) 50 * 5', resultado: '250' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // 64
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 2, 2, 2, 0, 0, 0, 0, 0, 0], // 100
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 3, 3, 0, 0, 0, 0, 0, 0, 0] // 250
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '012456'
            },

            // Fase 20: Express√µes Mistas Complexas
            {
                operacoes: [
                    { op: '1) (2 ^ 4) + 10', resultado: '26' },
                    { op: '2) 100 / 4 + 5', resultado: '30' },
                    { op: '3) 3 * (-5) + 20', resultado: '5' }
                ],
                layout: [
                    [1, 1, 0, 0, 0, 0, 0, 0, 0, 0], // 26
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [0, 2, 2, 0, 0, 0, 0, 0, 0, 0], // 30
                    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    [3, 0, 0, 0, 0, 0, 0, 0, 0, 0] // 5
                ],
                gridSize: [5, 10],
                digitosDisponiveis: '02356'
            }
        ];

        // --- FUN√á√ïES DE L√ìGICA DO JOGO (mantidas e adaptadas) ---

        function loadPhase(index) {
            if (index < 0 || index >= phases.length) {
                document.querySelector('.main').innerHTML = '<h2 style="color: #00e676;">üéâ Fim do Jogo! Parab√©ns, Mestre da Matem√°tica! üéâ</h2>';
                return;
            }

            currentPhase = index;
            acertos = 0;
            const phase = phases[currentPhase];

            // 1. Atualizar T√≠tulo
            document.getElementById('tituloFase').textContent = `Termos Cruzados - Fase ${currentPhase + 1}`;

            // 2. Carregar Opera√ß√µes (Pistas)
            const hintsDiv = document.getElementById('hints');
            hintsDiv.innerHTML = phase.operacoes.map(p => `<div>**${p.op}** = ? (Resultado: **${p.resultado.length}** d√≠gitos/caracteres)</div>`).join('');

            // 3. Montar Tabuleiro (Crossword)
            const crosswordDiv = document.getElementById('crossword');
            crosswordDiv.innerHTML = '';
            // Define o n√∫mero de colunas do grid dinamicamente
            crosswordDiv.style.gridTemplateColumns = `repeat(${phase.gridSize[1]}, 45px)`;
            
            let cellIndex = 1; 
            for (let r = 0; r < phase.layout.length; r++) {
                for (let c = 0; c < phase.layout[r].length; c++) {
                    const cell = document.createElement('div');
                    const wordIndex = phase.layout[r][c]; 

                    if (wordIndex > 0) {
                        cell.classList.add('cell');
                        cell.dataset.pos = cellIndex++;
                        cell.dataset.word = wordIndex;
                        cell.textContent = '';
                    } else {
                        cell.classList.add('empty-cell');
                    }
                    crosswordDiv.appendChild(cell);
                }
            }
            
            // 4. Carregar Painel de D√≠gitos
            const panelDiv = document.getElementById('panel');
            panelDiv.innerHTML = '';
            // Cria um array de d√≠gitos (e o ponto/h√≠fen) a partir da string e os embaralha
            const shuffledDigits = phase.digitosDisponiveis.split('').sort(() => 0.5 - Math.random());
            
            shuffledDigits.forEach(digitChar => {
                const digit = document.createElement('div');
                digit.classList.add('digit');
                digit.textContent = digitChar === '.' ? '.' : digitChar; // Mant√©m ponto
                digit.draggable = true;
                panelDiv.appendChild(digit);
            });

            // 5. Reinicializar Resultados e Listeners
            document.getElementById('result').textContent = '';
            document.getElementById('estatisticas').textContent = '';
            setupDragAndDrop();
        }

        function setupDragAndDrop() {
            const digits = document.querySelectorAll('.digit');
            const cells = document.querySelectorAll('.cell');

            digits.forEach(digit => {
                digit.addEventListener('dragstart', () => {
                    draggedDigit = digit.textContent;
                });
            });

            cells.forEach(cell => {
                cell.addEventListener('dragover', e => {
                    e.preventDefault();
                    cell.classList.add('over');
                });

                cell.addEventListener('dragleave', () => {
                    cell.classList.remove('over');
                });

                cell.addEventListener('drop', () => {
                    if (draggedDigit) {
                        cell.textContent = draggedDigit;
                    }
                    cell.classList.remove('over');
                    draggedDigit = null;
                });

                // Adiciona a funcionalidade de clicar para limpar
                cell.addEventListener('click', () => {
                    cell.textContent = '';
                });
            });
        }

        function verificar() {
            const phase = phases[currentPhase];
            let operacoesCorretas = 0;
            const respostas = {};
            const cells = document.querySelectorAll('.cell');

            // 1. Coletar respostas por Opera√ß√£o (mantendo a ordem correta)
            // Agrupa as c√©lulas pelo √≠ndice da palavra (wordIndex) e posi√ß√£o (pos)
            const groupedCells = {};
            cells.forEach(cell => {
                const wordIndex = cell.dataset.word;
                const pos = parseInt(cell.dataset.pos); // Usado para garantir a ordem (opcional, mas bom para consist√™ncia)
                
                if (wordIndex) {
                    if (!groupedCells[wordIndex]) {
                        groupedCells[wordIndex] = [];
                    }
                    groupedCells[wordIndex].push({ pos: pos, content: cell.textContent.trim().toUpperCase() });
                }
            });

            // Converte os grupos de c√©lulas para strings de resposta (ordena pelo pos, depois concatena)
            for (const wordIndex in groupedCells) {
                groupedCells[wordIndex].sort((a, b) => a.pos - b.pos);
                respostas[wordIndex] = groupedCells[wordIndex].map(c => c.content).join('');
            }


            // 2. Comparar com Gabarito
            phase.operacoes.forEach((item, index) => {
                const wordIndex = index + 1;
                if (respostas[wordIndex] === item.resultado) {
                    operacoesCorretas++;
                }
            });

            acertos = operacoesCorretas;
            const resultDiv = document.getElementById('result');
            resultDiv.classList.remove('success', 'error');

            if (acertos === phase.operacoes.length) {
                resultDiv.textContent = '‚úÖ Todas as opera√ß√µes est√£o corretas! Voc√™ √© um g√™nio da matem√°tica!';
                resultDiv.classList.add('success');
            } else {
                resultDiv.textContent = `‚ùå ${acertos} de ${phase.operacoes.length} opera√ß√µes corretas. Revise seus c√°lculos!`;
                resultDiv.classList.add('error');
            }
        }

        function limpar() {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.textContent = ''; 
            });
            document.getElementById('result').textContent = '';
            document.getElementById('estatisticas').textContent = '';
        }

        function proximaRodada() {
            const phase = phases[currentPhase];
            const estatisticas = document.getElementById('estatisticas');
            const porcentagem = ((acertos / phase.operacoes.length) * 100).toFixed(2);
            estatisticas.textContent = `Acertos na fase atual: ${acertos} de ${phase.operacoes.length} opera√ß√µes (${porcentagem}%)`;

            if (acertos === phase.operacoes.length) {
                loadPhase(currentPhase + 1);
            } else {
                alert('Voc√™ precisa acertar todas as opera√ß√µes para passar para a pr√≥xima fase!');
            }
        }

        // Iniciar o jogo na primeira fase
        document.addEventListener('DOMContentLoaded', () => {
            loadPhase(0);
        });
    </script>
</body>
</html>